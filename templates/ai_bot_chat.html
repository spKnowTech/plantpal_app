{% extends 'base.html' %}
{% block css %}
<link rel="stylesheet" href="/static/css/ai_bot_chat.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
{% endblock %}

{% block content %}
<div class="container">
    <div class="left-panel">
        <h2>ðŸŒ± Plant Assistant</h2>
        <p>Your AI gardening companion</p>
        
        <!-- Plant Selection Info -->
        {% if user_plants %}
            <div class="plant-info">
                <h4>Your Plants</h4>
                {% for plant in user_plants %}
                <p><strong>{{ plant.name }}</strong> - {{ plant.location }}</p>
                {% endfor %}
            </div>
        {% else %}
            <div class="welcome-message">
                <p>ðŸ‘‹ Welcome! Add some plants to your dashboard first, then come back to chat with me about them!</p>
            </div>
        {% endif %}
    </div>
    
    <div class="right-panel">
        <!-- WhatsApp-style header -->
        <div class="chat-header">
            <div class="bot-avatar">
                <i class="fas fa-seedling"></i>
            </div>
            <div class="bot-info">
                <h3>PlantPal AI</h3>
                <p>ðŸŒ¿ Your gardening assistant</p>
            </div>
        </div>
        
        <div class="chat-window" id="chat-window">
            {% for message in chat_history %}
            <div class="chat-row {{ 'user' if message.is_user else 'bot' }}">
                {% if not message.is_user %}
                <span class="chat-avatar">
                    <i class="fas fa-seedling"></i>
                </span>
                {% endif %}
                <div class="chat-bubble {{ 'user-bubble' if message.is_user else 'bot-bubble' }}">
                    {{ message.text | safe }}
                    <div class="message-time">
                        {{ message.timestamp if message.timestamp else 'Now' }}
                    </div>
                </div>
                {% if message.is_user %}
                <span class="chat-avatar user-avatar">
                    <i class="fas fa-user"></i>
                </span>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        
        <form class="chat-input-area" method="post" action="/ai_chat" id="chat-form">
            <textarea name="user_message" placeholder="Type a message..." autocomplete="off" required style="flex: 1 !important; padding: 0.8rem 1.2rem !important; border: 1px solid #e9ecef !important; border-radius: 25px !important; font-size: 1rem !important; background: #f8f9fa !important; min-height: 3rem !important; max-height: 120px !important; resize: none !important; line-height: 1.4 !important; font-family: inherit !important; overflow-y: auto !important; word-wrap: break-word !important; white-space: pre-wrap !important; box-sizing: border-box !important; margin: 0 !important; outline: none !important;"></textarea>
            <button type="submit" id="send-button">
                <i class="fas fa-paper-plane" id="send-icon"></i>
                <div class="spinner" id="spinner"></div>
            </button>
        </form>
    </div>
</div>
{% endblock content %}

{% block jsfile %}
<script src="/static/js/ai_bot_chat.js"></script>
{% endblock jsfile %}